# Чек-лист ошибок и улучшений для Vue Mini CRM

## 1. Потенциальные ошибки

### 1.1. Логика работы с localStorage
- [ ] **Конфликт имен констант**: В `src/shared/constants/api.constants.ts` и `src/shared/storage/local-storage.util.ts` используются разные константы для одних и тех же ключей localStorage (`CUSTOMER_STORAGE_KEY` vs `LOCAL_STORAGE_KEYS.CUSTOMERS`)
- [ ] **Дублирование логики сохранения**: В каждом store (`customer.store.ts`, `deal.store.ts`, `pipeline.store.ts`) дублируется логика сохранения в localStorage, хотя есть общая утилита `local-storage.util.ts`
- [ ] **Несогласованное использование localStorage**: В `deal.store.ts` (строка 47-55) используется прямой доступ к localStorage вместо утилит из `local-storage.util.ts`

### 1.2. Работа с датами
- [ ] **Неконсистентное форматирование дат**: В различных частях приложения даты могут быть в разных форматах (ISO строка, Date объект)
- [ ] **Отсутствие валидации дат**: В форме сделки поле `closeDate` не имеет должной валидации

### 1.3. Ошибки в PipelineBoard.vue
- [ ] **Неиспользуемая функция**: Функция `onStageChange` определена в `PipelineBoard.vue` (строки 166-177), но не используется
- [ ] **Потенциальная ошибка в drag-and-drop**: В строках 153-164 компонента `PipelineBoard.vue` при перемещении сделок между стадиями может происходить некорректное обновление данных из-за глубокого наблюдения за объектом

### 1.4. Проблемы с типизацией
- [ ] **Небезопасное использование any**: В `PipelineBoard.vue` (строка 148) параметр `event` в функции `onMove` имеет тип `any`
- [ ] **Некорректная типизация валидации**: В `DealForm.vue` (строка 236) используется `yup.date()` без должной обработки формата даты

### 1.5. Проблемы с производительностью
- [ ] **Частые обновления localStorage**: При каждом изменении данных (создание, обновление, удаление) происходит синхронное сохранение в localStorage, что может замедлить работу приложения
- [ ] **Неправильное использование watch**: В `PipelineBoard.vue` используется `watch` с опцией `deep: true` для отслеживания изменений в `dealsByStageRef`, что может быть ресурсоемким

## 2. Улучшения архитектуры

### 2.1. Управление состоянием
- [ ] **Централизованное API управление**: Создать общий сервис для работы с API, чтобы избежать дублирования кода в `customer.api.ts`, `deal.api.ts`, `pipeline.api.ts`
- [ ] **Унификация работы с localStorage**: Создать единый слой абстракции для работы с localStorage, который будет использоваться всеми stores

### 2.2. Валидация
- [ ] **Централизованная валидация**: Объединить валидационные схемы в отдельный модуль для лучшего переиспользования
- [ ] **Улучшенные сообщения об ошибках**: Сделать сообщения об ошибках более информативными и пользовательскими

### 2.3. Структура проекта
- [ ] **Недостающий слой widgets**: В `README.md` упоминается директория `widgets/`, но в проекте она отсутствует
- [ ] **Недостающий слой lib**: В `README.md` упоминается директория `shared/lib/`, но в проекте она отсутствует

## 3. Потенциальные баги

### 3.1. Взаимодействие с API
- [ ] **Отсутствие обработки сетевых ошибок**: В моковой реализации API нет обработки ситуаций, когда localStorage недоступен или переполнен
- [ ] **Непоследовательная обработка ошибок**: В разных частях приложения ошибки обрабатываются по-разному

### 3.2. UI/UX проблемы
- [ ] **Отсутствие индикации загрузки**: В некоторых местах приложения нет индикаторов загрузки при выполнении асинхронных операций
- [ ] **Некорректная обработка ошибок валидации**: В `DealForm.vue` и `CustomerForm.vue` могут быть проблемы с отображением ошибок валидации при определенных условиях

## 4. Безопасность
- [ ] **Отсутствие санитизации данных**: При работе с пользовательским вводом нет санитизации данных перед сохранением
- [ ] **Отсутствие ограничений на размер данных**: Нет ограничений на размер сохраняемых данных в localStorage

## 5. Документация
- [ ] **Неполнота документации**: В `README.md` не описаны все функциональные возможности приложения
- [ ] **Отсутствие документации по API**: Нет описания мокового API и его возможностей

## 6. Тестирование
- [ ] **Неполное покрытие тестами**: В `TESTING_CHECKLIST.md` много непроверенных пунктов, особенно в разделах "Управление сделками", "Воронка продаж" и "Формы"
- [ ] **Отсутствие unit-тестов**: В проекте есть только один тестовый файл `HelloWorld.spec.ts`, остальные компоненты не покрыты тестами