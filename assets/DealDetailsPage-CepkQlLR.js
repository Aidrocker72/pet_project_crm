import{d as L,a as O,u as R,n as $,b as A,c as U,r as j,e as u,o as z,f as o,g as n,h as s,i as c,w as p,j as m,B as f,t as a,k as S,p as T,M as q,m as F}from"./index-Nm0vnLjc.js";const G={class:"crm-deal-details-page"},H={class:"page-header"},J={key:0,class:"loading"},K={key:1,class:"error"},Q={key:2,class:"deal-details"},W={class:"deal-info-card"},X={class:"deal-details-grid"},Y={class:"detail-item"},Z={class:"detail-value"},ee={class:"detail-item"},se={class:"detail-value"},te={class:"detail-item"},ae={class:"detail-value"},le={class:"detail-item"},ie={class:"detail-value"},oe={class:"detail-item"},ne={class:"detail-value"},de={class:"detail-item"},ue={class:"detail-value"},re={key:0,class:"detail-item"},ce={class:"detail-value"},ve={key:1,class:"detail-item"},pe={class:"detail-value"},_e={class:"detail-item"},me={class:"detail-value"},fe={class:"detail-item"},ge={class:"detail-value"},De={class:"deal-actions"},be={key:3,class:"empty-state"},ye=L({__name:"DealDetailsPage",setup(ke){const d=O(),g=R(),D=$(),b=A(),C=U(),r=j(!1),v=u(()=>C.params.id),t=u(()=>d.dealById(v.value)),h=u(()=>d.isLoading),y=u(()=>d.error),B=u(()=>g.allCustomers),k=u(()=>D.allPipelines),I=()=>{b.go(-1)},N=l=>{const e=B.value.find(i=>i.id===l);return e?e.name:"Неизвестный клиент"},w=l=>{const e=k.value.find(i=>i.id===l);return e?e.name:"Неизвестная воронка"},P=l=>{for(const e of k.value){const i=e.stages.find(E=>E.id===l);if(i)return i.name}return"Неизвестный этап"},_=l=>new Date(l).toLocaleDateString("ru-RU"),x=()=>{r.value=!0},M=async()=>{confirm("Вы уверены, что хотите удалить эту сделку?")&&(await d.deleteDeal(v.value)?b.push("/deals"):alert("Не удалось удалить сделку"))},V=async l=>{await d.updateDeal(v.value,l)?r.value=!1:alert("Не удалось обновить сделку")};return z(()=>{d.fetchDealById(v.value),g.fetchCustomers(),D.fetchPipelines()}),(l,e)=>(n(),o("div",G,[s("header",H,[e[3]||(e[3]=s("h1",{class:"page-title"},"Детали сделки",-1)),c(f,{onClick:I,variant:"secondary"},{default:p(()=>[...e[2]||(e[2]=[m("Назад",-1)])]),_:1})]),h.value?(n(),o("div",J," Загрузка данных сделки... ")):y.value?(n(),o("div",K,a(y.value),1)):t.value?(n(),o("div",Q,[s("div",W,[s("h2",null,a(t.value.title),1),s("div",X,[s("div",Y,[e[4]||(e[4]=s("span",{class:"detail-label"},"Клиент:",-1)),s("span",Z,a(N(t.value.customerId)),1)]),s("div",ee,[e[5]||(e[5]=s("span",{class:"detail-label"},"Воронка:",-1)),s("span",se,a(w(t.value.pipelineId)),1)]),s("div",te,[e[6]||(e[6]=s("span",{class:"detail-label"},"Этап:",-1)),s("span",ae,a(P(t.value.stageId)),1)]),s("div",le,[e[7]||(e[7]=s("span",{class:"detail-label"},"Сумма:",-1)),s("span",ie,"$"+a(t.value.value.toLocaleString()),1)]),s("div",oe,[e[8]||(e[8]=s("span",{class:"detail-label"},"Вероятность:",-1)),s("span",ne,a(t.value.probability)+"%",1)]),s("div",de,[e[9]||(e[9]=s("span",{class:"detail-label"},"Статус:",-1)),s("span",ue,a(t.value.status),1)]),t.value.closeDate?(n(),o("div",re,[e[10]||(e[10]=s("span",{class:"detail-label"},"Дата закрытия:",-1)),s("span",ce,a(_(t.value.closeDate)),1)])):S("",!0),t.value.description?(n(),o("div",ve,[e[11]||(e[11]=s("span",{class:"detail-label"},"Описание:",-1)),s("span",pe,a(t.value.description),1)])):S("",!0),s("div",_e,[e[12]||(e[12]=s("span",{class:"detail-label"},"Дата создания:",-1)),s("span",me,a(_(t.value.createdAt)),1)]),s("div",fe,[e[13]||(e[13]=s("span",{class:"detail-label"},"Дата обновления:",-1)),s("span",ge,a(_(t.value.updatedAt)),1)])])]),s("div",De,[c(f,{onClick:x,variant:"outline"},{default:p(()=>[...e[14]||(e[14]=[m("Редактировать сделку",-1)])]),_:1}),c(f,{onClick:M,variant:"danger"},{default:p(()=>[...e[15]||(e[15]=[m("Удалить сделку",-1)])]),_:1})])])):(n(),o("div",be," Сделка не найдена ")),c(q,{isOpen:r.value,"onUpdate:isOpen":e[1]||(e[1]=i=>r.value=i),title:"Редактировать сделку",size:"large"},{default:p(()=>[c(T,{initialData:t.value,onSubmit:V,onCancel:e[0]||(e[0]=i=>r.value=!1)},null,8,["initialData"])]),_:1},8,["isOpen"])]))}}),Ce=F(ye,[["__scopeId","data-v-bdfeb7f9"]]);export{Ce as default};
