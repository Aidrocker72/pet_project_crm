import{d as I,u as $,a as E,b as M,c as N,r as V,e as c,o as L,f as t,g as a,h as e,i as v,w as m,j as f,B as y,t as o,k as _,F as O,l as F,_ as P,M as R,m as T}from"./index-Bl1eKueW.js";const j={class:"crm-customer-details-page"},z={class:"page-header"},U={key:0,class:"loading"},q={key:1,class:"error"},A={key:2,class:"customer-details"},G={class:"customer-info-card"},H={class:"customer-details-grid"},J={class:"detail-item"},K={class:"detail-value"},Q={key:0,class:"detail-item"},W={class:"detail-value"},X={key:1,class:"detail-item"},Y={class:"detail-value"},Z={key:2,class:"detail-item"},ss={class:"detail-value"},es={key:3,class:"detail-item"},ts={class:"detail-value"},as={class:"customer-deals-section"},ls={key:0,class:"deals-list"},os=["onClick"],is={class:"deal-info"},ns={class:"deal-value"},ds={class:"deal-status"},us={key:1,class:"empty-state"},rs={class:"customer-actions"},cs={key:3,class:"empty-state"},vs=I({__name:"CustomerDetailsPage",setup(ms){const d=$(),h=E(),p=M(),C=N(),u=V(!1),r=c(()=>C.params.id),l=c(()=>d.customerById(r.value)),D=c(()=>d.isLoading),k=c(()=>d.error),g=c(()=>h.allDeals.filter(n=>n.customerId===r.value)),b=()=>{p.go(-1)},B=n=>{p.push(`/deals/${n}`)},S=()=>{u.value=!0},w=async()=>{confirm("Вы уверены, что хотите удалить этого клиента?")&&(await d.deleteCustomer(r.value)?p.push("/customers"):alert("Не удалось удалить клиента"))},x=async n=>{await d.updateCustomer(r.value,n)?u.value=!1:alert("Не удалось обновить клиента")};return L(()=>{d.fetchCustomerById(r.value),h.fetchDeals()}),(n,s)=>(a(),t("div",j,[e("header",z,[s[3]||(s[3]=e("h1",{class:"page-title"},"Детали клиента",-1)),v(y,{onClick:b,variant:"secondary"},{default:m(()=>[...s[2]||(s[2]=[f("Назад",-1)])]),_:1})]),D.value?(a(),t("div",U," Загрузка данных клиента... ")):k.value?(a(),t("div",q,o(k.value),1)):l.value?(a(),t("div",A,[e("div",G,[e("h2",null,o(l.value.name),1),e("div",H,[e("div",J,[s[4]||(s[4]=e("span",{class:"detail-label"},"Email:",-1)),e("span",K,o(l.value.email),1)]),l.value.phone?(a(),t("div",Q,[s[5]||(s[5]=e("span",{class:"detail-label"},"Телефон:",-1)),e("span",W,o(l.value.phone),1)])):_("",!0),l.value.company?(a(),t("div",X,[s[6]||(s[6]=e("span",{class:"detail-label"},"Компания:",-1)),e("span",Y,o(l.value.company),1)])):_("",!0),l.value.position?(a(),t("div",Z,[s[7]||(s[7]=e("span",{class:"detail-label"},"Должность:",-1)),e("span",ss,o(l.value.position),1)])):_("",!0),l.value.notes?(a(),t("div",es,[s[8]||(s[8]=e("span",{class:"detail-label"},"Заметки:",-1)),e("span",ts,o(l.value.notes),1)])):_("",!0)])]),e("div",as,[s[9]||(s[9]=e("h3",null,"Сделки клиента",-1)),g.value.length>0?(a(),t("div",ls,[(a(!0),t(O,null,F(g.value,i=>(a(),t("div",{key:i.id,class:"deal-item",onClick:_s=>B(i.id)},[e("div",is,[e("h4",null,o(i.title),1),e("p",null,o(i.description||"Без описания"),1)]),e("div",ns,"$"+o(i.value.toLocaleString()),1),e("span",ds,o(i.status),1)],8,os))),128))])):(a(),t("div",us," У клиента пока нет сделок "))]),e("div",rs,[v(y,{onClick:S,variant:"outline"},{default:m(()=>[...s[10]||(s[10]=[f("Редактировать клиента",-1)])]),_:1}),v(y,{onClick:w,variant:"danger"},{default:m(()=>[...s[11]||(s[11]=[f("Удалить клиента",-1)])]),_:1})])])):(a(),t("div",cs," Клиент не найден ")),v(R,{isOpen:u.value,"onUpdate:isOpen":s[1]||(s[1]=i=>u.value=i),title:"Редактировать клиента",size:"large"},{default:m(()=>[v(P,{initialData:l.value,onSubmit:x,onCancel:s[0]||(s[0]=i=>u.value=!1)},null,8,["initialData"])]),_:1},8,["isOpen"])]))}}),fs=T(vs,[["__scopeId","data-v-aaea2878"]]);export{fs as default};
